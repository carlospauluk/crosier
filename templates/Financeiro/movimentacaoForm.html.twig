{% extends 'index.html.twig' %}




{% block page_content %}

<div class="card">
	<div class="card-header">

		<div class="row">
			<div class="col-8">
				<h3>Movimentação</h3>
			</div>
			<div class="col-4 text-right">
				<button type="button" class="btn btn-secondary"
					onclick="window.location.href='{{ url('movimentacao_list') }}'">
					<i class="fas fa-sync" aria-hidden="true"></i> Listar
				</button>
			</div>
		</div>

	</div>

	<div class="card-body">

		{{ include('Util/flashes.html.twig') }}

		{% form_theme form 'bootstrap_4_horizontal_layout.html.twig' %}

		{{ form_start(form) }}
		{{ form_widget(form) }}

		<div class="row">
			<div class="col text-right">
				<button type="submit" class="btn btn-primary btn-lg" value="Salvar">
					<i class="fas fa-save" aria-hidden="true"></i> Salvar
				</button>

				<button type="button" value="Resetar" class="btn btn-secondary"
					data-url="{{ url('movimentacao_form') }}"
					data-target="#confirmationModal" data-toggle="modal">
					<i class="fas fa-undo" aria-hidden="true"></i> Recarregar
				</button>
			</div>
		</div>


		{{ form_end(form) }}


	</div>
</div>





{% endblock %}


{% block down_scripts %}


<script>
	//Bind click to OK button within popup
	$('#btnYes').on(
			'click',
			function(e) {
				var $modalDiv = $(e.delegateTarget);
				var url = $(this).data('url');
				var form = $('<form></form>').attr("method", "get").attr(
						"action", url);
				$(form).appendTo('body').submit();

			});



	// In your Javascript (external .js resource or <script> tag)
	$(document).ready(function() {
		$("#movimentacao_documentoBanco").select2();
			
	    $("#movimentacao_pessoa").select2({
	    	  ajax: {
	    	    delay: 250,
	    	    url: function (params) {
					console.log(params);
	    	        return '{{ url('pessoaFindByNome') }}' + '/' + params.term;
	    	    },
	    	    dataType: 'json',
	    	    processResults: function (data, params) {
					var dataNew = $.map(data.results, function (obj) {
						obj.text = obj.nome; // replace name with the property used for the text
						return obj;
					});
    				return { results: dataNew };
				},
	    	    cache: true
	    	  },
	    	  minimumInputLength: 1
	    	});


		function resValorTotal() {
			var valor = $("#movimentacao_valor").maskMoney('unmasked')[0];
			var descontos = $("#movimentacao_descontos").maskMoney('unmasked')[0];
			var acrescimos = $("#movimentacao_acrescimos").maskMoney('unmasked')[0];
			var valorTotal = (valor - descontos + acrescimos).toFixed(2);
			$("#movimentacao_valor_total").val(valorTotal);
			$("#movimentacao_valor_total").maskMoney('mask');
			
		}
	    
    	$("#movimentacao_valor").blur(function () {resValorTotal()});
    	$("#movimentacao_descontos").blur(function () {resValorTotal()});
    	$("#movimentacao_acrescimos").blur(function () {resValorTotal()});


        $("#movimentacao_dtVenctoEfetiva").focus(
                function() {
        			$.get( 
                			"{{ url('findProximoDiaUtilFinanceiro') }}/?dia=" + encodeURIComponent($("#movimentacao_dtVencto").val()), 
				        	function( data ) {
                				$("#movimentacao_dtVenctoEfetiva").val(data);
        					});
        		});
            	
	}); // $(document).ready(function() {
	
	
	
	
	

</script>

{% endblock %}